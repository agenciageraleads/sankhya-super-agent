# Configuração de Regras de Negócio - Compras
# Define pesos e configurações para os algoritmos de decisão

analysis:
  safety_stock_days: 15     # Dias de estoque de segurança além do Lead Time
  demand_buffer: 0.20       # 20% de margem de segurança na demanda (Treinamento)
  abc_strategy:
    A:
      min_stock_coverage: 15 # Dias mínimos de cobertura para curva A
      max_stock_coverage: 45
    B:
      min_stock_coverage: 10
      max_stock_coverage: 30
    C:
      min_stock_coverage: 5
      max_stock_coverage: 15

margins:
  retail: 0.28             # 28% para Varejo
  wholesale: 0.25          # 25% para Atacado

ranking:
  price_weight: 0.6          # 60% peso preço
  deadline_weight: 0.3       # 30% peso prazo
  reliability_weight: 0.1    # 10% peso confiabilidade fornecedor

alternatives:
  strategy: "brand_group"    # Estratégia de busca de alternativos (brand_group, tgfpro_field, custom_sql)
  custom_sql_path: "queries_alternatives.sql" # Se strategy for custom_sql

# Lead Time Dinâmico
leadtime:
  fallback_strategy:
    - historical_6mo      # Prioridade 1: Histórico 6 meses
    - supplier_category   # Prioridade 2: Média da categoria do fornecedor
    - static_gir          # Prioridade 3: TGFGIR.LEADTIME
    - default_30_days     # Prioridade 4: Default conservador

  outlier_filter:
    min_days: 0           # Rejeitar entregas negativas
    max_days: 180         # Rejeitar entregas > 6 meses

  minimum_samples: 2      # Mínimo de entregas para validade estatística

  temporal_weights:
    last_3_months: 0.7    # Últimos 3 meses = 70% do peso
    months_3_to_6: 0.3    # 3-6 meses = 30% do peso

# Controle de Budget (CMV-based)
budget_control:
  enabled: true
  growth_factor_annual: 0.20     # 20% de crescimento anual esperado

  allocation_strategy:
    method: "margin_weighted"     # Distribuição por margem
    exploration_reserve: 0.05     # 5% reservado para novos fornecedores

  enforcement:
    mode: "hard_cap"              # HARD CAP: bloqueia compras que excedam
    override_permission: "GERENTE_COMPRAS"

  margin_calculation:
    minimum_margin: 0.05          # Excluir fornecedores com margem < 5%
    lookback_period_months: 6     # Calcular margem dos últimos 6 meses
    volume_weight_factor: "sqrt"  # Fator de volume: raiz quadrada

# Validações
validation:
  require_leadtime_source: true   # Exibir fonte do lead time
  block_negative_margin_purchases: true
  alert_threshold_budget_usage: 0.80     # Alertar quando fornecedor usar 80% do budget
